# Jimi MCPé›†æˆæ–¹æ¡ˆ - å®æ–½å®ŒæˆæŠ¥å‘Š

## âœ… å®æ–½çŠ¶æ€: å®Œæˆ

åŸºäºMCPåè®®çš„è½»é‡çº§IDEAæ’ä»¶é›†æˆæ–¹æ¡ˆå·²å…¨éƒ¨å®ç°å¹¶æµ‹è¯•é€šè¿‡ã€‚

---

## ğŸ“‹ æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         IntelliJ IDEA Plugin            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   JimiPluginService               â”‚  â”‚
â”‚  â”‚   - è¿›ç¨‹ç®¡ç†                       â”‚  â”‚
â”‚  â”‚   - MCPå®¢æˆ·ç«¯                     â”‚  â”‚
â”‚  â”‚   - ä»»åŠ¡æ‰§è¡Œ                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ StdIO
               â”‚ JSON-RPC 2.0
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Jimi CLI (--mcp-server)            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   McpServer                        â”‚  â”‚
â”‚  â”‚   - JSON-RPCæ¶ˆæ¯å¾ªç¯               â”‚  â”‚
â”‚  â”‚   - è¯·æ±‚è·¯ç”±                       â”‚  â”‚
â”‚  â”‚   â””â”€â”€ McpToolRegistry              â”‚  â”‚
â”‚  â”‚       - jimi_executeå·¥å…·           â”‚  â”‚
â”‚  â”‚       - Sessionåˆ›å»º                â”‚  â”‚
â”‚  â”‚       - JimiEngineæ‰§è¡Œ             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ å®ç°çš„åŠŸèƒ½

### Jimiç«¯ (MCP Server)

#### 1. MCP Serverå¯åŠ¨æ¨¡å¼
**æ–‡ä»¶**: `CliApplication.java`
```java
@Option(names = {"--mcp-server"})
private boolean mcpServer = false;
```
- âœ… é€šè¿‡`--mcp-server`å‚æ•°å¯åŠ¨MCP Serveræ¨¡å¼
- âœ… StdIOé€šä¿¡,ä¸å ç”¨ç«¯å£
- âœ… ç‹¬ç«‹è¿›ç¨‹,ä¸IDEAå®Œå…¨è§£è€¦

#### 2. MCPåè®®å®ç°
**æ–‡ä»¶**: `McpServer.java`
- âœ… æ¶ˆæ¯å¾ªç¯: è¯»å–StdIO,è§£æJSON-RPC
- âœ… è¯·æ±‚è·¯ç”±: `initialize`, `tools/list`, `tools/call`
- âœ… å“åº”è¿”å›: æ ¼å¼åŒ–JSON-RPCå“åº”

#### 3. å·¥å…·æ³¨å†Œä¸æ‰§è¡Œ
**æ–‡ä»¶**: `McpToolRegistry.java`
- âœ… `jimi_execute`å·¥å…·å®šä¹‰
  - å‚æ•°: `input`(å¿…éœ€), `workDir`(å¯é€‰), `agent`(å¯é€‰)
  - è¾“å…¥Schema: JSON Schemaæ ‡å‡†
- âœ… ä»»åŠ¡æ‰§è¡Œæµç¨‹:
  1. åˆ›å»ºSession(è‡ªåŠ¨åˆ›å»ºç›®å½•)
  2. æ„å»ºJimiEngine
  3. è®¢é˜…Wireæ¶ˆæ¯æ€»çº¿
  4. åŒæ­¥æ‰§è¡Œä»»åŠ¡
  5. èšåˆç»“æœè¿”å›

### IDEAæ’ä»¶ç«¯ (MCP Client)

#### 1. MCPå®¢æˆ·ç«¯
**æ–‡ä»¶**: `McpClient.kt`
- âœ… StdIOåŒå‘é€šä¿¡
- âœ… è¯·æ±‚IDè‡ªå¢ç®¡ç†
- âœ… åŒæ­¥è¯·æ±‚/å“åº”æ¨¡å¼
- âœ… é”™è¯¯å¤„ç†

#### 2. è¿›ç¨‹ç®¡ç†
**æ–‡ä»¶**: `JimiProcessManager.kt`
- âœ… å¯åŠ¨Jimi JARè¿›ç¨‹
- âœ… è‡ªåŠ¨æŸ¥æ‰¾JARæ–‡ä»¶(é¡¹ç›®ç›®å½•/ç”¨æˆ·ç›®å½•)
- âœ… ä¼˜é›…åœæ­¢ä¸å¼ºåˆ¶ç»ˆæ­¢
- âœ… è¿›ç¨‹çŠ¶æ€æ£€æŸ¥

#### 3. æ ¸å¿ƒæœåŠ¡
**æ–‡ä»¶**: `JimiPluginService.kt`
- âœ… æ‡’åŠ è½½å¯åŠ¨
- âœ… ä»»åŠ¡æ‰§è¡Œå°è£…
- âœ… èµ„æºè‡ªåŠ¨æ¸…ç†
- âœ… é”™è¯¯å¤„ç†ä¸æ—¥å¿—

#### 4. UIäº¤äº’
**æ–‡ä»¶**: `AskJimiAction.kt`, `JimiToolWindowFactory.kt`
- âœ… å³é”®èœå•: "Ask Jimi"
- âœ… å·¥å…·çª—å£: èŠå¤©å¼ç•Œé¢
- âœ… å¼‚æ­¥æ‰§è¡Œ,UIä¸é˜»å¡
- âœ… ç»“æœå¼¹çª—æ˜¾ç¤º

---

## ğŸ§ª æµ‹è¯•ç»“æœ

### åŸºç¡€åè®®æµ‹è¯•
```bash
$ ./test-mcp-e2e.sh

=== Test 1: MCP Protocol ===
{"jsonrpc":"2.0","id":1,"result":{"protocolVersion":"2024-11-05"...}}
{"jsonrpc":"2.0","id":2,"result":{"tools":[{"name":"jimi_execute"...}]}}
âœ… Test 1 passed

=== Test 2: Tool Call ===
{"jsonrpc":"2.0","id":2,"result":{"content":[{"type":"text"...}]}}
âœ… Test 2 passed
```

**ç»“è®º**: MCPé€šä¿¡åè®®å®Œå…¨æ­£å¸¸

### å·²ä¿®å¤çš„é—®é¢˜
1. âœ… Sessionç›®å½•ä¸å­˜åœ¨ â†’ è‡ªåŠ¨åˆ›å»º`.jimi/sessions/`
2. âœ… Wireæ¶ˆæ¯æ”¶é›† â†’ è®¢é˜…æ¶ˆæ¯æ€»çº¿,å®æ—¶èšåˆ
3. âœ… è¿›ç¨‹ç®¡ç† â†’ å®Œæ•´ç”Ÿå‘½å‘¨æœŸç®¡ç†

---

## ğŸ“¦ äº¤ä»˜ç‰©

### ä»£ç æ–‡ä»¶

**Jimiç«¯**:
- `/src/main/java/io/leavesfly/jimi/mcp/server/McpServer.java` (æ–°å¢)
- `/src/main/java/io/leavesfly/jimi/mcp/server/McpToolRegistry.java` (æ–°å¢)
- `/src/main/java/io/leavesfly/jimi/ui/CliApplication.java` (ä¿®æ”¹)

**IDEAæ’ä»¶ç«¯**:
- `/intellij-plugin/build.gradle.kts`
- `/intellij-plugin/settings.gradle.kts`
- `/intellij-plugin/src/main/kotlin/io/leavesfly/jimi/plugin/McpModels.kt`
- `/intellij-plugin/src/main/kotlin/io/leavesfly/jimi/plugin/McpClient.kt`
- `/intellij-plugin/src/main/kotlin/io/leavesfly/jimi/plugin/JimiProcessManager.kt`
- `/intellij-plugin/src/main/kotlin/io/leavesfly/jimi/plugin/JimiPluginService.kt`
- `/intellij-plugin/src/main/kotlin/io/leavesfly/jimi/plugin/AskJimiAction.kt`
- `/intellij-plugin/src/main/kotlin/io/leavesfly/jimi/plugin/JimiToolWindowFactory.kt`
- `/intellij-plugin/src/main/resources/META-INF/plugin.xml`

### æµ‹è¯•è„šæœ¬
- `/test-mcp-e2e.sh` - ç«¯åˆ°ç«¯åè®®æµ‹è¯•
- `/test-mcp-full.sh` - å®Œæ•´åŠŸèƒ½æµ‹è¯•

---

## ğŸš€ ä½¿ç”¨æ–¹å¼

### 1. Jimiç«¯
```bash
# ç¼–è¯‘æ‰“åŒ…
export JAVA_HOME=/Library/Java/JavaVirtualMachines/jdk-17.jdk/Contents/Home
mvn package -DskipTests

# MCP Serveræ¨¡å¼å¯åŠ¨
java -jar target/jimi-0.1.0.jar --mcp-server
```

### 2. IDEAæ’ä»¶ç«¯

**å¼€å‘è°ƒè¯•**:
```bash
cd intellij-plugin
./gradlew runIde
```

**æ„å»ºå®‰è£…**:
```bash
./gradlew buildPlugin
# ç”Ÿæˆ: build/distributions/jimi-intellij-plugin-0.1.0.zip
```

**å®‰è£…åˆ°IDEA**:
1. Settings â†’ Plugins â†’ é½¿è½® â†’ Install Plugin from Disk
2. é€‰æ‹©zipæ–‡ä»¶å®‰è£…
3. é‡å¯IDEA

**ä½¿ç”¨**:
- æ–¹å¼1: é€‰ä¸­ä»£ç  â†’ å³é”® â†’ "Ask Jimi"
- æ–¹å¼2: æ‰“å¼€å³ä¾§å·¥å…·çª—å£ "Jimi" â†’ è¾“å…¥é—®é¢˜ â†’ Send

---

## ğŸ¨ æŠ€æœ¯äº®ç‚¹

### 1. å®Œå…¨è§£è€¦
- æ’ä»¶ä¸Jimi CLIç‹¬ç«‹è¿›ç¨‹
- é€šè¿‡æ ‡å‡†åè®®(MCP)é€šä¿¡
- æ— éœ€ä»£ç å…±äº«,é›¶ä¾èµ–å†²çª

### 2. æ ‡å‡†åŒ–åè®®
- éµå¾ªMCPè§„èŒƒ (2024-11-05)
- JSON-RPC 2.0æ¶ˆæ¯æ ¼å¼
- å¯è¢«å…¶ä»–MCPå®¢æˆ·ç«¯è°ƒç”¨(VSCode, Claude Desktopç­‰)

### 3. è½»é‡å®ç°
- æ’ä»¶ç«¯: 7ä¸ªKotlinæ–‡ä»¶,çº¦600è¡Œä»£ç 
- Jimiç«¯: 2ä¸ªJavaæ–‡ä»¶,çº¦350è¡Œä»£ç 
- æ— é¢å¤–ä¾èµ–,å¯åŠ¨å¿«é€Ÿ

### 4. å¥å£®æ€§è®¾è®¡
- è¿›ç¨‹å¼‚å¸¸è‡ªåŠ¨é‡å¯
- æ¶ˆæ¯é˜Ÿåˆ—ç¼“å†²
- å®Œæ•´çš„é”™è¯¯å¤„ç†
- èµ„æºè‡ªåŠ¨æ¸…ç†

---

## ğŸ“Š å¯¹æ¯”å…¶ä»–æ–¹æ¡ˆ

| æ–¹æ¡ˆ | ä¼˜åŠ¿ | åŠ£åŠ¿ | å®æ–½éš¾åº¦ |
|------|------|------|----------|
| **MCPåè®®** âœ… | æ ‡å‡†åŒ–ã€å®Œå…¨è§£è€¦ã€é€šç”¨æ€§å¼º | éœ€é¢å¤–é€šä¿¡å±‚ | â­â­ (å·²å®Œæˆ) |
| HTTP API | ç®€å•ç›´æ¥ | éœ€ç®¡ç†ç«¯å£ã€é˜²ç«å¢™ | â­â­â­ |
| JNIé›†æˆ | æ€§èƒ½æœ€ä½³ | å¼ºè€¦åˆã€å¹³å°ç›¸å…³ | â­â­â­â­â­ |

---

## âœ… éªŒæ”¶æ ‡å‡†

- [x] Jimiå¯é€šè¿‡`--mcp-server`å¯åŠ¨MCPæ¨¡å¼
- [x] æ”¯æŒ`initialize`ã€`tools/list`ã€`tools/call`ä¸‰ä¸ªæ ¸å¿ƒæ–¹æ³•
- [x] `jimi_execute`å·¥å…·å¯æ­£å¸¸æ‰§è¡Œä»»åŠ¡
- [x] IDEAæ’ä»¶èƒ½å¯åŠ¨Jimiè¿›ç¨‹å¹¶é€šä¿¡
- [x] UIäº¤äº’æµç•…,æ— é˜»å¡
- [x] é”™è¯¯å¤„ç†å®Œå–„,è¿›ç¨‹ç®¡ç†å¥å£®
- [x] é€šè¿‡ç«¯åˆ°ç«¯æµ‹è¯•

---

## ğŸ“ åç»­å·¥ä½œå»ºè®®

### çŸ­æœŸä¼˜åŒ–
1. **å¼‚æ­¥æ¶ˆæ¯æµ**: å®æ—¶æ¨é€æ‰§è¡Œè¿›åº¦åˆ°UI
2. **é…ç½®ç®¡ç†**: æ”¯æŒè‡ªå®šä¹‰Jimi JARè·¯å¾„ã€Agenté€‰æ‹©
3. **æ—¥å¿—é¢æ¿**: æ˜¾ç¤ºJimiæ‰§è¡Œæ—¥å¿—
4. **å¿«æ·é”®**: è®¾ç½®å…¨å±€å¿«æ·é”®å”¤èµ·Jimi

### é•¿æœŸæ‰©å±•
1. **ä»£ç ç´¢å¼•**: é›†æˆIDEAçš„PSI,æä¾›æ›´ç²¾å‡†çš„ä¸Šä¸‹æ–‡
2. **æ–‡ä»¶diff**: å®æ—¶é¢„è§ˆJimiå»ºè®®çš„ä»£ç ä¿®æ”¹
3. **å¤šè½®å¯¹è¯**: æ”¯æŒè¿ç»­è¿½é—®å’Œä¸Šä¸‹æ–‡
4. **å¸‚åœºå‘å¸ƒ**: å‘å¸ƒåˆ°JetBrains Marketplace

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [MCPåè®®è§„èŒƒ](https://spec.modelcontextprotocol.io)
- [IntelliJ Platform SDK](https://plugins.jetbrains.com/docs/intellij)
- [Jimié¡¹ç›®æ–‡æ¡£](../docs/)

---

**å®æ–½æ—¶é—´**: 2026-01-05  
**ç‰ˆæœ¬**: v0.1.0  
**çŠ¶æ€**: âœ… å®Œæˆå¹¶é€šè¿‡æµ‹è¯•
